"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();window.REDs.uiConfig=Object.freeze({homePlayback:{bgVideoJourney:{index:1,vidStart:2,vidEnd:21},bgVideoCar:{index:2,vidStart:50,vidEnd:63},bgVideoDesign:{index:3,vidStart:23,vidEnd:47}}}),window.REDs.FauxRouter=function(){function e(t){_classCallCheck(this,e),this._stateManager=t;for(var n=document.querySelectorAll("a[href]"),o=0;o<n.length;o++)n[o].setAttribute("hijacked",!0),n[o].addEventListener("click",this.hijackLinkClick.bind(this,n[o]));window.onpopstate=this.handlePopstate.bind(this)}return _createClass(e,[{key:"handlePopstate",value:function(e){this._stateManager.setState(this.hash)}},{key:"hijackLinkClick",value:function(e,t){var n=this.uriComponentToHash(e.href);this._stateManager.queryStateByRoute(n)&&(t.preventDefault(),this._stateManager.setState(n),REDs.utils.scrollToTop())}},{key:"uriComponentToHash",value:function(e){var t=e.indexOf("#");return t>=0?e.substr(t):void 0}},{key:"hash",get:function(){var e=window.location.hash;return e?e.indexOf("#")>=0?e:"#"+e:void 0},set:function(e){var t=e&&"string"==typeof e;window.location.hash=t?this.uriComponentToHash(e):""}}]),e}(),window.REDs.initialize=function(e,t,n){var o=document.getElementById("pageIndex");o.style.display="",window.scrollTo(0,1),document.body.addEventListener("touchstart",function(){REDs.utils.addClass(document.body,"hasTouch")});var i=o.querySelector("section.home"),a=new REDs.ScrollController(i),s=document.getElementById("homeBgVideo");a.registerNodeActions(s,"custom",{scrollbelowfold:function(){this.pause()},scrollabovefold:function(){this.play()}});document.getElementById("menuTrigger").addEventListener("click",function(){e.setState("menu")});document.getElementById("menuHomeLink").addEventListener("click",function(){e.setState("homeJourney")});var r=document.getElementById("socialButton");r.addEventListener("click",function(){REDs.utils.toggleClass(r,"opened")})},document.addEventListener("DOMContentLoaded",function(e){var t=document.getElementById("pageIndex");if(t){var n=new REDs.StateManager(t,"load");n.router=new REDs.FauxRouter(n),n.loader=new REDs.ResourceLoader(n,n.router.hash),window.REDs.initialize(n)}else console.warn("#pageIndex not found, but index.js is included.")}),window.REDs.ResourceLoader=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"mainVid";_classCallCheck(this,e),this._stateManager=t,this._assets=[],this._targetState=n,this._progress=0,this._progressCallbacks=[],this._onComplete=null,this.registerAssets(),this.assetLoadInterval()}return _createClass(e,[{key:"registerAssets",value:function(){for(var e=document.querySelectorAll("video,[data-preload-src]"),t=0;t<e.length;t++){var n=e[t].getAttribute("data-preload-src");if(e[t]instanceof HTMLVideoElement){var o=e[t].getAttribute("data-preload-full")?"videoFull":"video";this.registerSingleAsset(e[t],o)}else n&&this.registerSingleAsset(n,"imgSrc")}}},{key:"registerSingleAsset",value:function(e,t){this._assets.push({target:e,type:t,looping:"video"===t&&e.loop,loaded:!1}),e instanceof Node&&e.poster&&this.registerSingleAsset(e.poster,"imgSrc")}},{key:"assetLoadInterval",value:function(){var e=this,t=21;setTimeout(function n(){var o=e.validateAllAssets(),i=(21-t)/21;1!==o&&t>0?setTimeout(n,500):e.resolveLoadSession(),e.updateProgress(o,i),t-=1},500)}},{key:"validateAllAssets",value:function(){for(var e=0,t=0;t<this._assets.length;t++){var n=this._assets[t];switch(n.type){case"video":n.loaded=!!this.validateSimpleVideoAsset(n);break;case"videoFull":n.loaded=!!this.validateFullVideoAsset(n);break;case"imgSrc":n.loaded=!!this.validateImgSrcAsset(n);break;default:console.warn("Invalid asset registered in ResourceLoader: ",n)}n.loaded&&(e+=1)}return e/this._assets.length}},{key:"validateFullVideoAsset",value:function(e){if(e.loaded)return!0;if(e.loading)return!1;if(e.loading=!0,REDs.utils.isExplorerOrEdge()){return this.abortFullVideoLoad(e,"Optimizing rendering capacity for this browser."),!0}var t=this.getVideoSourceFromDOM(e.target);return t&&this.preloadFullVideo(e,t),!1}},{key:"validateSimpleVideoAsset",value:function(e){return 4===e.target.readyState}},{key:"validateImgSrcAsset",value:function(e){return!!e.loaded||!e.image&&(e.image=new Image,e.image.onload=function(){e.loaded=!0},void(e.image.src=e.target))}},{key:"preloadFullVideo",value:function(e,t){e.request=new XMLHttpRequest;var n=this;e.request.open("GET",t.url,!0),e.request.responseType="blob",e.request.onload=function(){if(4===this.readyState&&200===this.status){var o=void 0;e.loaded=!0;n.sanitizeBlob(this.response,t.mimetype,function(t){o=t,function t(){n.setVideoAssetSrc(e.target,o)||setTimeout(t,2e3)}()})}},e.request.send();setTimeout(this.abortFullVideoLoad.bind(this,e,"A video download request exceeded the acceptable timeframe."),2e4)}},{key:"getVideoSourceFromDOM",value:function(e){for(var t=e.querySelectorAll("source"),n=null,o=null,i=t.length-1;i>=0;i--){var a=t[i],s=a.getAttribute("type"),r=e.canPlayType(s);if(("maybe"===r||"probably"===r)&&(n={url:a.getAttribute("src"),mimetype:s},"probably"===r))return n;!n&&s&&(o={url:a.getAttribute("src"),mimetype:"video/mp4"})}return n||console.warn("Unable to get source from a .video[data-preload-full] elem with a readable mimetype. Does it have the `type` attribute set? ",e),n||o}},{key:"sanitizeBlob",value:function(e,t,n){var o=new FileReader;o.onloadend=function(){for(var e=atob(o.result.slice(o.result.indexOf(",")+1)),i=new Array(e.length),a=0;a<e.length;a++)i[a]=e.charCodeAt(a);var s=new Uint8Array(i),r=new Blob([s],{type:t}),l=URL.createObjectURL(r);n(l)},o.readAsDataURL(e)}},{key:"setVideoAssetSrc",value:function(e,t){return!REDs.utils.videoIsPlaying(e)&&(e.src=t,!0)}},{key:"abortFullVideoLoad",value:function(e,t){if(!e.loaded){e.request&&(e.request.abort(),delete e.request),e.target.pause();document.querySelector('.videoFallbackSet[data-for="'+e.target.id+'"]')&&(e.target.parentNode.removeChild(e.target),REDs.utils.addClass(document.body,"bgVideoFallback_"+e.target.id+"_active"),e.loaded=!0,"homeBgVideo"===e.target.id&&REDs.utils.useHomeBgVideoFallback()),console.warn('Aborting "fullVid" preloads.',t||"")}}},{key:"abortLoopingVideo",value:function(e,t){e.target.poster&&(e.target.innerHTML="",e.target.src="",e.target.load(),console.warn("Aborting looping video load.",t||""))}},{key:"abortAllFullLoads",value:function(e){for(var t=0;t<this._assets.length;t++)"fullVid"!==this._assets[t].type||this._assets[t].loaded||this.abortFullVideoLoad(this._assets[t],e)}},{key:"abortAllLoopingVideos",value:function(e){for(var t=0;t<this._assets.length;t++)"video"===this._assets[t].type&&!this._assets[t].loaded&&this._assets[t].looping&&this.abortLoopingVideo(this._assets[t],e)}},{key:"getProgress",value:function(){return this._progress}},{key:"detectVerySlowLoad",value:function(){document.querySelector(".mainVideo").readyState<4&&(this.abortAllFullLoads("Slow download detected."),this.abortAllLoopingVideos("Slow download detected."))}},{key:"updateProgress",value:function(e,t){this._progress=Math.max(e,t),this.onProgress()}},{key:"subscribeToProgress",value:function(e){this._progressCallbacks.push(e)}},{key:"onProgress",value:function(){for(var e=0;e<this._progressCallbacks.length;e++)"function"==typeof this._progressCallbacks[e]&&this._progressCallbacks[e](this._progress)}},{key:"setCompletionCallback",value:function(e){this._onComplete=e}},{key:"resolveLoadSession",value:function(){if(this.detectVerySlowLoad(),"function"==typeof this._onComplete&&!1===this._onComplete(this._targetState))return!1;this._stateManager.setState(this._targetState)}}]),e}(),window.REDs.ScrollController=function(){function e(t){var n=this;_classCallCheck(this,e),this._stateInstance=this.validatedStateInstance(t),this._parentNode=this._stateInstance.getParent(),this._scrollTop=0,this._targets=[],this._repeatPlayTypes=["parallax"],REDs.windowEvents.subscribe("scroll",function(){n._stateInstance.isActive()&&n.onScroll()}),REDs.windowEvents.subscribe("resize",function(){n.onResize()}),this.getTargetNodes()}return _createClass(e,[{key:"onScroll",value:function(e){for(var t=this.getScrollTop(),n=window.innerHeight,o=t+n,i=t+.4*n/2,a=i+.6*n,s=0;s<this._targets.length;s++){var r=this._targets[s];if(r.node&&("number"==typeof r.height||"number"==typeof r.top||this.requestTargetDimensions(r))){var l=r.top,c=l+r.height,u=l<=o&&c>=t,d=l<=a&&c>=i,h=t>n;u&&r.handlers.inview&&this.triggerHandler(r,"inview"),!u&&r.handlers.notinview&&this.triggerHandler(r,"notinview"),d&&r.handlers.incenter&&this.triggerHandler(r,"incenter"),h&&r.handlers.scrollbelowfold&&this.triggerHandler(r,"scrollbelowfold"),!h&&r.handlers.scrollabovefold&&this.triggerHandler(r,"scrollabovefold")}}}},{key:"onResize",value:function(){for(var e=0;e<this._targets.length;e++)this._targets[e].height=void 0,this._targets[e].top=void 0}},{key:"getTargetNodes",value:function(){for(var e=this._parentNode.querySelectorAll(".scrollTarget"),t=0;t<e.length;t++){var n=e[t];n.className.indexOf("scrollTargetVideo")>=0&&this.registerNodeActions(n,"loopVideo"),n.className.indexOf("scrollTargetFloatInText")>=0&&this.registerNodeActions(n,"titleFloatIn"),n.className.indexOf("scrollTargetBlockReveal")>=0&&this.registerNodeActions(n,"blockReveal"),n.className.indexOf("scrollTargetAnimatedClassInView")>=0&&this.registerNodeActions(n,"classInView"),n.className.indexOf("scrollTargetAnimatedClassInCenter")>=0&&this.registerNodeActions(n,"classInCenter")}}},{key:"registerNodeActions",value:function(e,t,n,o){n=n||this.getStandardHandlers(t),"titleFloatIn"===t&&this.convertStringToSpanArray(e);var i={node:e,handlers:n,repeatPlay:o||this._repeatPlayTypes.indexOf(t)>=0};this.requestTargetDimensions(i),this._targets.push(i)}},{key:"requestTargetDimensions",value:function(e){return!(!e.node.offsetHeight&&!e.node.offsetWidth)&&(e.height=e.node.offsetHeight,e.top=this.getNodeTopPosition(e.node),!0)}},{key:"convertStringToSpanArray",value:function(e){for(var t=e.getElementsByTagName("span"),n=t.length-1;n>=0;--n){for(var o=t[n].innerHTML,i="",a=o.length-1;a>=0;a--){var s=o[a];i=(/\s+/.test(s)?" ":"<i>"+s+"</i>")+i}i=i.replace(/&.+;/gi,"&amp;"),t[n].innerHTML=i}}},{key:"getStandardHandlers",value:function(e){var t={};switch(e){case"loopVideo":t.notinview=function(){this.pause()},t.leavestate=t.notinview,t.inview=function(){this.className.indexOf("revealed")?this.play():setTimeout(this.play,250)};break;case"titleFloatIn":t.incenter=function(){REDs.utils.addClass(this,"floatTextIn")};break;case"blockReveal":t.inview=function(){REDs.utils.addClass(this,"revealed")};break;case"classInView":t.inview=function(){REDs.utils.addClass(this,"animated")};break;case"classInCenter":t.incenter=function(){REDs.utils.addClass(this,"animated")}}return t}},{key:"triggerHandler",value:function(e,t){var n;if(e.handlers[t]&&(e.previousEvent!==t||e.repeatPlay)){for(var o=arguments.length,i=Array(o>2?o-2:0),a=2;a<o;a++)i[a-2]=arguments[a];(n=e.handlers[t]).apply.apply(n,[e.node].concat(i)),e.previousEvent=t}}},{key:"triggerLeaveState",value:function(){for(var e=0;e<this._targets.length;e++)this.triggerHandler(this._targets[e],"leavestate")}},{key:"getNodeTopPosition",value:function(e){for(var t=0;e&&"BODY"!==e.tagName;)t+=e.offsetTop,e=e.offsetParent;return t}},{key:"getScrollTop",value:function(){return this._scrollTop=document.body.scrollTop||document.documentElement.scrollTop,this._scrollTop}},{key:"validatedStateInstance",value:function(e){return e instanceof REDs.StateInstance?e:{isActive:function(){return!0},getParent:function(){return e}}}}]),e}(),window.REDs.stateConfig.push({namespace:"homeCar",route:"#home/car",parentSelector:"section.home",eventMap:{on:function(e,t,n){e.querySelector(".centralContentWrap").scrollLeft=1*document.body.offsetWidth,REDs.utils.homeHandleVideoOn(REDs.uiConfig.homePlayback.bgVideoCar,t)},off:function(e,t,n){REDs.utils.homeHandleVideoOff(n)}},handlers:{".centralContentWrap":{touchend:function(e,t,n,o){REDs.utils.handleHomeScrollEnd(e,t,n,o)}},"body #homeBgVideo":{timeupdate:function(e,t,n,o){REDs.utils.homeHandleVideoTimeUpdate(this,n)}}}}),window.REDs.stateConfig.push({namespace:"homeDesign",route:"#home/design",parentSelector:"section.home",eventMap:{on:function(e,t,n){e.querySelector(".centralContentWrap").scrollLeft=2*document.body.offsetWidth,REDs.utils.homeHandleVideoOn(REDs.uiConfig.homePlayback.bgVideoDesign,t)},off:function(e,t,n){REDs.utils.homeHandleVideoOff(n)}},handlers:{".centralContentWrap":{touchend:function(e,t,n,o){REDs.utils.handleHomeScrollEnd(e,t,n,o)}},"body #homeBgVideo":{timeupdate:function(e,t,n,o){REDs.utils.homeHandleVideoTimeUpdate(this,n)}}}}),window.REDs.stateConfig.push({namespace:"homeJourney",route:"#home/journey",parentSelector:"section.home",eventMap:{on:function(e,t,n){e.querySelector(".centralContentWrap").scrollLeft=0*document.body.offsetWidth,REDs.utils.homeHandleVideoOn(REDs.uiConfig.homePlayback.bgVideoJourney,t)},off:function(e,t,n){REDs.utils.homeHandleVideoOff(n)}},handlers:{".centralContentWrap":{touchend:function(e,t,n,o){REDs.utils.handleHomeScrollEnd(e,t,n,o)}},"body #homeBgVideo":{timeupdate:function(e,t,n,o){REDs.utils.homeHandleVideoTimeUpdate(this,n)}}}}),window.REDs.stateConfig.push({namespace:"load",route:null,parentSelector:"section.loader",eventMap:{on:function(e,t,n){var o=e.querySelector(".loadingFill"),i=e.querySelector(".loadedPercent"),a=n.loader,s=5,r=0,l=void 0,c=!1,u="mainVid",d=function(){r<s?(r+=1,o.style.width=r+"%",i.innerHTML=(r<10?"0":"")+r):(clearInterval(l),c&&n.setState(u))};a.subscribeToProgress(function(e){if(n.getState().current.namespace===t.namespace){var o=Math.floor(100*e);s=Math.min(o,100),clearInterval(l),l=setInterval(d,30)}}),a.setCompletionCallback(function(e){return c=!0,u=e,!1})},afteroff:function(e,t,n){e.querySelector(".loadingFill").style.width="0%"}},handlers:{".loadingGraphic":{click:function(e,t,n,o){}}}}),window.REDs.stateConfig.push({namespace:"mainVid",route:"#documentary",parentSelector:"section.videoPlayer",eventMap:{on:function(e,t,n){var o=e.querySelector(".mainVideo"),i=e.querySelector(".videoControls"),a=n.getState().previous,s=e.querySelector("#iosPlayButton"),r=!REDs.utils.isMobile()||!(!REDs.utils.isMobile()||!t.getData("iosMainPlayTriggered")),l=r?"addClass":"removeClass",c=r?"removeClass":"addClass";r?o.play():s.style.display="flex",o.muted=!1,REDs.utils[l](i,"playing"),REDs.utils[c](i,"paused"),REDs.utils.addClass(i,"volumeOn"),REDs.utils[c](i,"volumeOff"),a&&"load"!==a.namespace&&REDs.utils.addClass(e,"fromHomeSub")},off:function(e,t,n){var o=e.querySelector(".mainVideo"),i=e.querySelector(".videoControls");o.pause(),o.currentTime=0,o.muted=!1,REDs.utils.addClass(i,"paused"),REDs.utils.removeClass(i,"playing"),REDs.utils.addClass(i,"volumeOn"),REDs.utils.removeClass(e,"fromHomeSub")}},handlers:{".mainVideo":{timeupdate:function(e,t,n,o){var i=t.querySelector(".textPlayedTime"),a=t.querySelector(".textTotalTime"),s=t.querySelector(".playbackFill"),r=(this.currentTime%60).toFixed(0);r=1===r.length?"0"+r:r;var l=Math.floor(this.currentTime/60)+":"+r,c=(this.duration%60).toFixed(0);c=1===c.length?"0"+c:c;var u=Math.floor(this.duration/60)+":"+c,d=(this.currentTime/this.duration*100).toFixed(2)+"%";i.innerHTML=l,a.innerHTML=u,s.style.width=d},ended:function(e,t,n,o){var i=o.getState(),a="homeJourney";i.previous&&"load"!==i.previous.namespace&&(a=i.previous.namespace),o.setState(a)}},".actionPlay":{click:function(e,t,n,o){var i=t.querySelector(".mainVideo"),a=t.querySelector(".videoControls"),s=t.querySelector("#iosPlayButton");i.play(),REDs.utils.removeClass(a,"paused"),REDs.utils.addClass(a,"playing"),n.setData("iosMainPlayTriggered",!0),s.style.display="none"}},".actionPause":{click:function(e,t,n,o){var i=t.querySelector(".mainVideo"),a=t.querySelector(".videoControls");i.pause(),REDs.utils.removeClass(a,"playing"),REDs.utils.addClass(a,"paused")}},".actionMute":{click:function(e,t,n,o){var i=t.querySelector(".mainVideo"),a=t.querySelector(".videoControls");i.muted=!0,REDs.utils.removeClass(a,"volumeOn"),REDs.utils.addClass(a,"volumeOff")}},".actionUnmute":{click:function(e,t,n,o){var i=t.querySelector(".mainVideo"),a=t.querySelector(".videoControls");i.muted=!1,REDs.utils.removeClass(a,"volumeOff"),REDs.utils.addClass(a,"volumeOn")}},".closeButton":{click:function(e,t,n,o){o.goBack()}}}}),window.REDs.stateConfig.push({namespace:"menu",route:"#menu",parentSelector:"section.menu",eventMap:{on:function(e,t,n){},off:function(e,t,n){}},handlers:{".menuCloseButton":{click:function(e,t,n,o){o.goBack()}},".centralContentWrap":{touchend:function(e,t,n,o){if("a"!==e.target.tagName.toLowerCase()){var i=t.querySelector(".centralContentWrap"),a=t.querySelector(".chapterNav .chapterIndicatorFill"),s=i.scrollLeft+i.offsetWidth/2,r=Math.floor(s/i.offsetWidth),l=document.body.offsetWidth*r;REDs.utils.scrollTo(i,l,250,"horo"),a.style.left=33.4*r+"%"}}}}}),window.REDs.stateConfig.push({namespace:"subCar",route:"#chapter/car",parentSelector:'section.homeSub .subSet[data-index="2"]',scrollTrack:!0,eventMap:{on:function(e,t,n){REDs.utils.homeHandleVideoOn(REDs.uiConfig.homePlayback.bgVideoCar,t)},off:function(e,t,n){REDs.utils.homeHandleVideoOff(n)}},handlers:{"body #homeScrollButton":{click:function(){REDs.utils.scrollBelowFold()}},"body #subPlayButton":{click:function(e,t,n,o){o.setState("mainVid")}},"body #homeBgVideo":{timeupdate:function(e,t,n,o){REDs.utils.homeHandleVideoTimeUpdate(this,n)}}}}),window.REDs.stateConfig.push({namespace:"subDesign",route:"#chapter/design",parentSelector:'section.homeSub .subSet[data-index="3"]',scrollTrack:!0,eventMap:{on:function(e,t,n){REDs.utils.homeHandleVideoOn(REDs.uiConfig.homePlayback.bgVideoDesign,t)},off:function(e,t,n){REDs.utils.homeHandleVideoOff(n)}},handlers:{"body #homeScrollButton":{click:function(){REDs.utils.scrollBelowFold()}},"body #subPlayButton":{click:function(e,t,n,o){o.setState("mainVid")}},"body #homeBgVideo":{timeupdate:function(e,t,n,o){REDs.utils.homeHandleVideoTimeUpdate(this,n)}}}}),window.REDs.stateConfig.push({namespace:"subJourney",route:"#chapter/journey",parentSelector:'section.homeSub .subSet[data-index="1"]',scrollTrack:!0,eventMap:{on:function(e,t,n){REDs.utils.homeHandleVideoOn(REDs.uiConfig.homePlayback.bgVideoJourney,t)},off:function(e,t,n){REDs.utils.homeHandleVideoOff(n)}},handlers:{"body #homeScrollButton":{click:function(){REDs.utils.scrollBelowFold()}},"body #subPlayButton":{click:function(e,t,n,o){o.setState("mainVid")}},"body #homeBgVideo":{timeupdate:function(e,t,n,o){REDs.utils.homeHandleVideoTimeUpdate(this,n)}}}}),window.REDs.StateInstance=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{namespace:"",route:"",parentSelector:"body",eventMap:{},handlers:{},scrollTrack:!1},n=t.namespace,o=t.route,i=t.parentSelector,a=t.eventMap,s=t.handlers,r=t.scrollTrack;if(_classCallCheck(this,e),!n)throw new Error("A new StateInstance requires a namespace");this._namespace=n,this._route=o,this._parentNode=document.querySelector(i),this._events=a,this._handlers=s,this._data={},this._activeHandlers={},this._scrollTrack=!!r}return _createClass(e,[{key:"getParent",value:function(){return this._parentNode}},{key:"setData",value:function(e,t){this._data[e]=t}},{key:"getData",value:function(e){return this._data[e]}},{key:"isActive",value:function(){return this.stateManager.isCurrentState(this)}},{key:"initializeScrollControl",value:function(){this._scrollTrack&&!this.scrollController&&(this.scrollController=new REDs.ScrollController(this))}},{key:"triggerEvent",value:function(e){var t=this._events[e];"on"===e&&(this.bindAllHandlers(),this.initializeScrollControl()),e.indexOf("off")>=0&&(this.removeAllHandlers(),this._data={}),"function"==typeof t&&t(this._parentNode,this,this._stateManager)}},{key:"bindAllHandlers",value:function(){if(this._handlers&&!(!this._handlers instanceof Array))for(var e in this._handlers)if(this._handlers.hasOwnProperty(e)){var t=this._handlers[e];for(var n in t)t.hasOwnProperty(n)&&this.bindSingleHandler(e,n,t[n])}}},{key:"bindSingleHandler",value:function(e,t,n){var o=this,i=void 0;if((i=e.indexOf("body")>=0?document.querySelectorAll(e):this._parentNode.querySelectorAll(e)).length){var a=e+"#"+t;this._activeHandlers[a]&&this.removeSingleHandler(this._activeHandlers[a]),this._activeHandlers[a]={nodes:i,event:t,func:function(e){n.apply(e.target,[e,o._parentNode,o,o._stateManager])}};for(var s=0;s<i.length;s++)i[s].addEventListener(t,this._activeHandlers[a].func)}else console.warn('No matching nodes for the selector "'+e+'" while binding event handlers.')}},{key:"removeAllHandlers",value:function(){this.scrollController&&this.scrollController.triggerLeaveState();for(var e in this._activeHandlers)this._activeHandlers.hasOwnProperty(e)&&this.removeSingleHandler(this._activeHandlers[e])}},{key:"removeSingleHandler",value:function(e){for(var t=0;t<e.nodes.length;t++)e.nodes[t].removeEventListener(e.event,e.func)}},{key:"route",get:function(){return this._route}},{key:"namespace",get:function(){return this._namespace}},{key:"stateManager",set:function(e){this._stateManager=e},get:function(){return this._stateManager}},{key:"scrollController",set:function(e){this._scrollController=e},get:function(){return this._scrollController}}]),e}(),window.REDs.StateManager=function(){function e(t,n){_classCallCheck(this,e),this._parentNode=t,this._states={},this._currentState=null,this._previousState=null,this.ingestStateConfig(REDs.stateConfig),this.setState(n)}return _createClass(e,[{key:"setState",value:function(e){var t=this.queryStateByNS(e)||this.queryStateByRoute(e);t&&!this.isCurrentState(t)&&(this._previousState=this._currentState||null,this._currentState=t,this.changeParentClass(this._previousState,"remove"),this.changeParentClass(this._currentState,"add"),this.triggerInstanceEvent(this._previousState,"off"),this.triggerInstanceEvent(this._currentState,"on"),this.triggerInstanceEvent(this._previousState,"afteroff"),this.router&&(this.router.hash=t.route))}},{key:"getState",value:function(){return{current:this._currentState,previous:this._previousState}}},{key:"goBack",value:function(){this._previousState&&this.setState(this._previousState.namespace)}},{key:"isCurrentState",value:function(){if(!this._currentState)return!1;for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var o=0;o<t.length;o++){var i=t[o];if((i instanceof REDs.StateInstance?i.namespace:i).toLowerCase()===this._currentState.namespace.toLowerCase())return!0}return!1}},{key:"triggerInstanceEvent",value:function(e,t){if(e){var n=0;switch(t){case"on":case"off":break;case"afteroff":n=500;break;default:return void console.warn("Invalid event passed to stateManager#triggerInstanceEvent: "+t)}setTimeout(e.triggerEvent.bind(e,t),n)}}},{key:"changeParentClass",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"add";if(e){var n="add"===t?"addClass":"removeClass";REDs.utils[n](this._parentNode,e.namespace)}}},{key:"queryStateByNS",value:function(e){return this._states[e]||null}},{key:"queryStateByRoute",value:function(e){var t=void 0;for(var n in this._states)this._states.hasOwnProperty(n)&&this._states[n].route===e&&(t=this._states[n]);return t||null}},{key:"ingestStateConfig",value:function(e){for(var t=0;t<e.length;t++){var n=e[t],o=void 0;if(this.queryStateByNS(n.namespace))console.warn("Skipping duplicated state config for namespace: "+n.namespace);else{switch(n.type){case"video":o="VideoStateInstance";break;default:o="StateInstance"}var i=new REDs[o](e[t]);this.registerStateInstance(i)}}}},{key:"registerStateInstance",value:function(e){var t=e.namespace;if(this._states[t])throw new Error("Duplicate keys cannot be registered in stateManager. Key: "+t);this._states[t]=e,e.stateManager=this}},{key:"loader",set:function(e){this._loader=e},get:function(){return this._loader}},{key:"router",set:function(e){this._router=e},get:function(){return this._router}}]),e}(),window.REDs.utils=Object.freeze({isMobile:function(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e},isExplorerOrEdge:function(){var e=window.navigator.userAgent;return e.indexOf("MSIE ")>=0?"lteIE10":e.indexOf("Trident/")>=0?"IE11":e.indexOf("Edge/")>=0&&"edge"},addClass:function(e,t){for(var n=[].concat(t),o=0;o<n.length;o++)this.addSingleClass(e,n[o])},removeClass:function(e,t){for(var n=[].concat(t),o=0;o<n.length;o++)this.removeSingleClass(e,n[o])},addSingleClass:function(e,t){if(e.className.indexOf(t)<0){var n=e.className.length>0?" ":"";e.className+=n+t}},removeSingleClass:function(e,t){var n=new RegExp(" *"+t,"g");e.className=e.className.replace(n,"")},toggleClass:function(e,t){this[e.className.indexOf(t)<0?"addClass":"removeClass"](e,t)},hasClass:function(e,t){return e.className.indexOf(t)>=0},scrollTo:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vert",i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){},a=e||window,s="horo"===o?function(e){a.scrollTo(e,0)}:function(e){a.scrollTo(0,e)},r="horo"===o?"scrollLeft":"scrollTop",l=e?e[r]:document.documentElement[r]||document.body[r],c=t-l,u=function(e,t,n,o){return(e/=o/2)<1?n/2*e*e+t:(e-=1,-n/2*(e*(e-2)-1)+t)};!function e(o){var a=u(o+=20,l,c,n);s(a),o<n?setTimeout(function(){e(o)},20):(s(t),i())}(0)},scrollBelowFold:function(){this.scrollTo(null,window.innerHeight,250,"vert")},scrollToTop:function(e){e=e||0,this.scrollTo(null,0,e,"vert")},handleHomeScrollEnd:function(e,t,n,o){if("a"!==e.target.tagName.toLowerCase()){var i=t.querySelector(".centralContentWrap"),a=i.scrollLeft+i.offsetWidth/2,s=Math.floor(a/i.offsetWidth),r=["homeJourney","homeCar","homeDesign"][s],l=document.body.offsetWidth*s;this.scrollTo(i,l,250,"horo",function(){o.setState(r)})}},playLoopingVideoAtIndex:function(e,t){e&&(e.pause(),e.currentTime=t,e.play())},pauseLoopingVideo:function(e){e&&e.pause()},videoIsPlaying:function(e){return!!e&&(e.currentTime>0&&!e.paused&&!e.ended)},handleLoopingVideoTimeUpdate:function(e,t,n){(e&&e.currentTime>=n||e.currentTime<t-2)&&(e.currentTime=t)},homeHandleVideoOn:function(e,t){var n={minSecs:e.vidStart,maxSecs:e.vidEnd},o=document.getElementById("homeBgVideo");t.setData("loopTimes",n),o?this.videoIsPlaying(o)||this.playLoopingVideoAtIndex(o,n.minSecs):this.useHomeBgVideoFallback(e.index)},homeHandleVideoOff:function(e){if(!e.isCurrentState("homeJourney","homeCar","homeDesign","subJourney","subCar","subDesign")){var t=document.getElementById("homeBgVideo");this.pauseLoopingVideo(t)}},homeHandleVideoTimeUpdate:function(e,t){var n=t.getData("loopTimes");this.handleLoopingVideoTimeUpdate.apply(null,[e,n.minSecs,n.maxSecs])},useHomeBgVideoFallback:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"1",t=document.querySelector('.videoFallbackSet[data-for="homeBgVideo"]'),n=0;n<t.children.length;n++){var o=t.children[n],i=parseInt(o.getAttribute("data-index"));o.style.display="block",o.style.zIndex=i===e?"0":"-1"}}}),window.REDs.windowEvents=new(function(){function e(){var t=this;_classCallCheck(this,e);var n=!1;this._subscriptions=[],window.addEventListener("scroll",function(e){n||(window.requestAnimationFrame(function(){t.emit("scroll"),n=!1}),n=!0)}),window.addEventListener("resize",function(e){t.emit("resize")})}return _createClass(e,[{key:"subscribe",value:function(e,t){"function"==typeof t&&this._subscriptions.push({type:e,callback:t})}},{key:"emit",value:function(e){for(var t=0;t<this._subscriptions.length;t++)this._subscriptions[t].type===e&&this._subscriptions[t].callback()}}]),e}());
//# sourceMappingURL=index.js.map
